# 魔法迭代专用工具

设计目的：
  实现自适应原图采样[1]的专用工具
  
子结构：
  1. 设计理念
  2. 设计原理
  3. 高级迭代

## 一、设计理念

首先让我们模拟这样一个场景：在一张（1000, 1000）的风景照上，有一个区域包含人群，我们希望尽可能多从这些人群区域采集素材，而尽可能少的从其它区域采集，为此，我们预先标定一个矩形的目标区域（或近似矩形的单联通区域） -> 现在，我们只需要在目标区域内进行采样即可。

现在问题来了，怎样才能合理遍历这个矩形区域呢？

在讨论怎样设计之前，我们需要明确一下什么是“合理”：
  1. 目标区域之中的像素应当仅被采集一次
  2. 目标区域之外的像素不应该被采集
  3. 任何情况下，采集区域不能超越图像的边界

目标1保证了采样的均匀性，目标2排除了那些不期望被选择的“脏样本”，目标3则保证了采样方法的可用性。

让我们回到小学，列一个简单的表达式：
```
设木板长度 L，将其截断为长度 x 的短板，总共能截出几段？
L = n * x + r
上式，n表示截出的段数，r表示剩余木板的长度。
若我们期待这个表达式有意义，需额外规定 0 <= r < x，这样一来，它就表达了“ L 除以 x 得 n 余 r ”的数学含义。
显然，该数学含义亦对应着“长 L 的木板截出 n 段长 x 的短板后余长 r ”的应用含义。
该表达式说明：
木板余长 r 被木板长度 L 和短板长度 x 所唯一确定。
```
目标区域是依据图像标定的，不是一个可变量；采样的窗口尺寸通常受制于模型本身，也不是一个可变量；而现在，我们期待余长 r==0 。

受限于客观因素，上述目标无法同时实现，因此只好对“合理性”做出妥协：
  1. 目标区域之中的像素至少被采集一次
  2. 目标区域之外的像素至多被采集一次
  3. 目标区域之中的采样两次的像素越少越好，且应均匀分布于目标区域各处
  4. 目标区域之外的采样一次的像素越少越好，且应当尽可能临近目标区域
  5. 任何情况下，采集区域不能超越图像的边界

现在，一个初通算法的中学生也清楚如何解决该问题了。

## 二、设计原理

我们仍试图将“题解”展示出来:
```
显然该问题中，X方向与Y方向对称，解决其一即可，仍用 L = n * x + r 表示，考虑极端情况：
  1. 若图像边界无穷远（目标5不产生实际影响），则令 L' = L + x - r，显然 L' = (n+1) * x
  2. 若图像边界为0（目标2、目标4不产生实际影响），则令 x' = (L + r) / n，显然 L = n * x'
上两式均满足 r' == 0，前式 L'-L 表示超界采样的长度，后式 x-x' 表示窗口尺寸缩小的长度。
```
前文提到，L 受制于图像本身的特征，而 x 受制于模型的需要，二者皆不可变，因此，应用该算法时需首先结合自身业务的敏感特征，以决定是否采用该算法、或如何应用该算法。








